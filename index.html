<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Getting Started : ">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Getting Started</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/splusminusx">View on GitHub</a>

          <h1 id="project_title">Getting Started</h1>
          <h2 id="project_tagline"></h2>

        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a id="livetex-sdk-Стартовая-документация" class="anchor" href="#livetex-sdk-%D0%A1%D1%82%D0%B0%D1%80%D1%82%D0%BE%D0%B2%D0%B0%D1%8F-%D0%B4%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D0%B0%D1%86%D0%B8%D1%8F" aria-hidden="true"><span class="octicon octicon-link"></span></a>LiveTex SDK. Стартовая документация</h1>

<p><strong>Livetex SDK</strong> предоставляет инструментарий для реализации возможность 
консультировать пользователей мобильных приложений. </p>

<p>Функциональность:</p>

<ul>
<li>возможность выбора департамента и оператора для диалога;</li>
<li>создание и завершение диалога;</li>
<li>передача и прием текстовых сообщений;</li>
<li>прием файлов от оператора;</li>
<li>мгновенное оповещение о событиях: бан, оповещение о наборе, 
удерживающие сообщения, изменение оператора диалога,
закрытие диалога оператором;</li>
<li>просмотр истории сообщений;</li>
</ul>

<p>Документация API: </p>

<ul>
<li>
<a href="http://splusminusx.github.io/java/index.html">Android</a> </li>
<li><a href="http://splusminusx.github.io/ios/index.html">iOS</a></li>
</ul>

<p>Demo-приложение: </p>

<ul>
<li>
<a href="https://github.com/LiveTex/Livetex-Android-SDK-Demo">Android</a> </li>
<li><a href="https://github.com/LiveTex/Livetex-iOS-SDK-Demo">iOS</a></li>
</ul>

<h2>
<a id="С-чего-начать" class="anchor" href="#%D0%A1-%D1%87%D0%B5%D0%B3%D0%BE-%D0%BD%D0%B0%D1%87%D0%B0%D1%82%D1%8C" aria-hidden="true"><span class="octicon octicon-link"></span></a>С чего начать?</h2>

<h3>
<a id="Шаг-1-Создание-аккаунта" class="anchor" href="#%D0%A8%D0%B0%D0%B3-1-%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5-%D0%B0%D0%BA%D0%BA%D0%B0%D1%83%D0%BD%D1%82%D0%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>Шаг 1. Создание аккаунта</h3>

<p>Регистрируемся в системе <a href="https://billing.livetex.ru/signup/">Livetex</a>, 
добавляем <a href="https://billing.livetex.ru/operators/operator/add/">оператора</a> и 
<a href="https://billing.livetex.ru/site/add">сайт</a>.</p>

<h3>
<a id="Шаг-2-Получение-инструментов" class="anchor" href="#%D0%A8%D0%B0%D0%B3-2-%D0%9F%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B8%D0%BD%D1%81%D1%82%D1%80%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D0%BE%D0%B2" aria-hidden="true"><span class="octicon octicon-link"></span></a>Шаг 2. Получение инструментов</h3>

<p><a href="mailto:sdk@livetex.ru">Запрашиваем</a> ключ разработчика, доступ к 
"песочнице" и бинарный пакет SDK. В письме необходимо указать идентификатор
аккаунта и название платформы.</p>

<h3>
<a id="Шаг-3-Добавление-библиотеки-sdk-к-проекту" class="anchor" href="#%D0%A8%D0%B0%D0%B3-3-%D0%94%D0%BE%D0%B1%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B1%D0%B8%D0%B1%D0%BB%D0%B8%D0%BE%D1%82%D0%B5%D0%BA%D0%B8-sdk-%D0%BA-%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D1%83" aria-hidden="true"><span class="octicon octicon-link"></span></a>Шаг 3. Добавление библиотеки SDK к проекту</h3>

<p>Пример добавления библиотеки SDK к проекту можно найти в репозитории с 
demo-приложением.</p>

<h3>
<a id="Шаг-4-Разработка-обработчиков-оповещений-от-сервера" class="anchor" href="#%D0%A8%D0%B0%D0%B3-4-%D0%A0%D0%B0%D0%B7%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%BA%D0%B0-%D0%BE%D0%B1%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%87%D0%B8%D0%BA%D0%BE%D0%B2-%D0%BE%D0%BF%D0%BE%D0%B2%D0%B5%D1%89%D0%B5%D0%BD%D0%B8%D0%B9-%D0%BE%D1%82-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>Шаг 4. Разработка обработчиков оповещений от сервера</h3>

<p>Livetex SDK предоставляет возможность мгновенного оповещения о новых 
событиях от сервера. Новые события могут влиять на отображение информации 
пользователю приложения. Livetex SDK требует от разработчика реализации 
обработчика оповещений от сервера. Детали интерфейса обработчика можно найти 
по ссылкам:</p>

<ul>
<li>INotificationHandler <a href="http://splusminusx.github.io/java/nit/livetex/mymodule/sdk/handler/INotificationDialogHandler.html#INotificationDialogHandler">Android</a>
</li>
<li>LTMobileSDKNotificationHandlerProtocol <a href="http://splusminusx.github.io/ios/Protocols/LTMbileSDKNotificationHandlerProtocol/index.html#//apple_ref/occ/intf/LTMbileSDKNotificationHandlerProtocol">iOS</a>
</li>
</ul>

<p>Пример обработчика оповещений на Java с функциональностью открытия диалога и отсылки сообщения.</p>

<div class="highlight highlight-java"><pre>
<span class="c1">// Обработчик инициализации.</span>
<span class="k">class</span> <span class="nc">CustomInitHandler</span> <span class="k">implements</span> <span class="no">IInitHandler</span> {

  <span class="k">private</span> <span class="kt">Livetex</span> sdk;

  <span class="nf">CustomInitHandler</span>(<span class="kt">Livetex</span> <span class="nv">livetex</span>) {
    sdk <span class="o">=</span> livetex;
  }

  <span class="c1">// В случае успешной инициализации сохраняем переданный токен и создаем обращение.</span>
  <span class="k">public</span> <span class="kt">void</span> <span class="nf">onSuccess</span>(<span class="kt">String</span> <span class="nv">token</span>) {
    saveTokenToCustomClientStorage(token);
    sdk<span class="o">.</span>request(<span class="k">new</span> <span class="kt">AHandler&lt;<span class="kt">State</span>&gt;</span>());
  }
}

<span class="k">class</span> <span class="nc">CustomNotificationHandler</span> <span class="k">implements</span> <span class="no">INotificationHandler</span> {

  <span class="k">private</span> <span class="kt">Livetex</span> sdk;

  <span class="nf">CustomNotificationHandler</span>(<span class="kt">Livetex</span> <span class="nv">livetex</span>) {
    sdk <span class="o">=</span> livetex;
  }

  <span class="m">...</span>

  <span class="c1">// При назначении оператора для диалога отправляем приветственное сообщение.</span>
  <span class="k">public</span> <span class="kt">void</span> <span class="nf">updateDialogState</span>(<span class="kt">DialogState</span> <span class="nv">state</span>) {
    <span class="k">if</span> (state<span class="o">.</span>isSetEmployee()) {
      sdk<span class="o">.</span>sendTextMessage(<span class="s2">"Hello"</span>, <span class="k">new</span> <span class="kt">AHandler&lt;<span class="kt">TextMessage</span>&gt;</span>());
    }
  }

  <span class="c1">// Логируем сообщения оператора.</span>
  <span class="k">public</span> <span class="kt">void</span> <span class="nf">receiveTextMessage</span>(<span class="kt">TextMessage</span> <span class="nv">message</span>) {
    <span class="kt">System</span><span class="o">.</span>out<span class="o">.</span>println(message<span class="o">.</span>getText());
  }
  <span class="m">...</span>
}
</pre></div>

<p>Пример обработчика оповещений на Objective-c с функциональностью открытия диалога и отсылки сообщения.</p>

<div class="highlight highlight-objective-c"><pre>
<span class="kt">@interface</span> <span class="nc">LTCustomNotificationDelegate</span> : <span class="no">NSObject</span>  &lt;LTMobileSDKNotificationHandlerProtocol&gt;
<span class="k">@property</span>(<span class="k">nonatomic</span>, <span class="k">copy</span>) <span class="kt">void</span> (^callBack) (<span class="kt">id</span> data);
<span class="kt">@end</span>

...

<span class="kt">@implementation</span> <span class="nc">LTCustomNotificationDelegate</span>

<span class="c1">// Обработка изменения состояния.</span>
- (<span class="kt">void</span>) <span class="nf">updateDialogState</span><span class="nf">:</span> (LTDialogState *) <span class="nv">state</span>
{
    <span class="c1">// Проверяем назначен ли оператор для диалога.</span>
    <span class="k">if</span> (state.<span class="nv">employee</span> != <span class="kc">nil</span>) {
      <span class="c1">// Отправляем сообщение.</span>
      [sdk <span class="nf">sendMessage:</span><span class="s2">@"Hello"</span> <span class="nf">success:</span>^(LTTextMessage *message) {
        ...
      } <span class="nf">failure:</span>^(<span class="no">NSException</span> *chatExeption) {
        ...
      }];
    }
}

<span class="c1">// Обработка нового сообщения от оператора.</span>
- (<span class="kt">void</span>) <span class="nf">receiveTextMessage</span><span class="nf">:</span> (LTTextMessage *) <span class="nv">message</span>
{
    <span class="nf">NSLog</span>(message.<span class="nv">text</span>);
}
<span class="kt">@end</span>
</pre></div>

<h3>
<a id="Шаг-5-Инициализация-sdk" class="anchor" href="#%D0%A8%D0%B0%D0%B3-5-%D0%98%D0%BD%D0%B8%D1%86%D0%B8%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F-sdk" aria-hidden="true"><span class="octicon octicon-link"></span></a>Шаг 5. Инициализация SDK</h3>

<p>Пример инициализации Android SDK в основном потоке приложения.</p>

<div class="highlight highlight-java"><pre><span class="c1">// URL сервиса аутентификации, получен на втором шаге данного гайда.</span>
string url <span class="o">=</span> <span class="s2">"http://authentication-sandbox.livetex.ru:9000"</span>;

<span class="c1">// Ключ SDK для аутентификации кодовой базы клиент, получен на втором шаге данного гайда.</span>
string key <span class="o">=</span> <span class="s2">"NEVER_SHOW_THIS_KEY_TO_STRANGERS"</span>;

<span class="c1">// Идентификатор приложения клиента - это идентификатор сайта, который можно </span>
<span class="c1">// получить в личном кабинете.</span>
string application <span class="o">=</span> <span class="s2">"10001350"</span>;

<span class="c1">// Список возможностей реализованных в клиентском приложении.</span>
<span class="kt">List&lt;<span class="kt">Capabilities</span>&gt;</span> capabilities <span class="o">=</span> <span class="k">new</span> <span class="kt">ArrayList&lt;<span class="kt">Capabilities</span>&gt;</span>();

<span class="c1">// Клиентское приложение умеет вести диалог.</span>
capabilities<span class="o">.</span>add(<span class="kt">Capabilities</span><span class="no"><span class="o">.</span>CHAT</span>);

<span class="c1">// Клиентское приложение умеет принимать файлы.</span>
capabilities<span class="o">.</span>add(<span class="kt">Capabilities</span><span class="no"><span class="o">.</span>FILES_RECEIVE</span>);

<span class="c1">// Получение токена аутентификации из персистентного хранилища клиента SDK.</span>
<span class="c1">// Реализуется на усмотрение разработчика. На этапе инициализации SDK можно</span>
<span class="c1">// указать уникальный токен для идентификации клиента и восстановления </span>
<span class="c1">// истории переписки. Если токен указан не будет система создаст нового </span>
<span class="c1">// клиента.    </span>
<span class="kt">String</span> token <span class="o">=</span> getTokenFromCustomClientStorage();

<span class="kt">Builder</span> builder <span class="o">=</span> <span class="k">new</span> <span class="kt">Builder</span>(context, key, application);
builder<span class="o">.</span>addCapabilities(capabilities);
builder<span class="o">.</span>addToken(token);
builder<span class="o">.</span>addUrl(url);

<span class="kt">Livetex</span> livetex <span class="o">=</span> <span class="k">new</span> builder.build();

<span class="c1">// Обработчик инициализации SDK реализуется разработчиком.</span>
<span class="kt">CustomInitHandler</span> initHandler <span class="o">=</span> <span class="k">new</span> <span class="kt">CustomInitHandler</span>(livetex);
<span class="c1">// Обработчик оповещений от сервера реализуется разработчиком.</span>
<span class="kt">CustomNotificationHandler</span> notificationHandler <span class="o">=</span> <span class="k">new</span> <span class="kt">CustomNotificationHandler</span>(livetex);

livetex<span class="o">.</span>init(initHandler, notificationHandler);</pre></div>

<p>Пример инициализации iOS SDK в основном потоке приложения.</p>

<div class="highlight highlight-objective-c"><pre>LTMobileSDKInitializationParams *params = [LTMobileSDKInitializationParams <span class="nf">new</span>];

<span class="c1">// URL сервиса аутентификации, получен на втором шаге данного гайда.</span>
params.livetexUrl = <span class="s2">@"http://authentication-sandbox.livetex.ru:9000"</span>;

<span class="c1">// Ключ SDK для аутентификации кодовой базы клиент, получен на втором шаге данного гайда.</span>
params.sdkKey = <span class="s2">@"NEVER_SHOW_THIS_KEY_TO_STRANGERS"</span>;


<span class="c1">// Идентификатор приложения клиента - это идентификатор сайта, который можно </span>
<span class="c1">// получить в личном кабинете.</span>
params.applicationId = <span class="s2">@"10001350"</span>;

params.callbackQueue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_BACKGROUND, <span class="m">0</span>);

LTMobileSDK *sdk = [[LTMobileSDK <span class="nf">alloc</span>] <span class="nf">initWithParams:</span>params];

<span class="c1">// Инициализация кастомного обработчика оповещений.</span>
LTCustomNotificationDelegate *delegate = [LTCustomNotificationDelegate <span class="nf">new</span>];
sdk.delegate = delegate;

<span class="c1">// Инициализация SDK.</span>
[sdk <span class="nf">runWithSuccess:</span>^(<span class="no">NSString</span> *token) {

    <span class="c1">// Запрос диалога с любым оператормо сайта.</span>
    [sdk <span class="nf">requestWithSuccess:</span>^(LTDialogState *state) {
        <span class="c1">//...</span>
    } <span class="nf">failure:</span>^(<span class="no">NSException</span> *chatExeption) {
        <span class="c1">//...</span>
    }];

} <span class="nf">failure:</span>^(<span class="no">NSException</span> *exception) {

    [<span class="nb">self</span> <span class="nf">tstPassedBAD</span>];
}];</pre></div>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
