<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Getting Started : ">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Getting Started</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/splusminusx">View on GitHub</a>

          <h1 id="project_title">Getting Started</h1>
          <h2 id="project_tagline"></h2>

        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a id="livetex-sdk-Стартовая-документация" class="anchor" href="#livetex-sdk-%D0%A1%D1%82%D0%B0%D1%80%D1%82%D0%BE%D0%B2%D0%B0%D1%8F-%D0%B4%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D0%B0%D1%86%D0%B8%D1%8F" aria-hidden="true"><span class="octicon octicon-link"></span></a>LiveTex SDK. Стартовая документация</h1>

<p><strong>Livetex SDK</strong> предоставляет инструментарий для реализации возможность 
консультировать пользователей мобильных приложений. </p>

<p>Функциональность:</p>

<ul>
<li>возможность выбора департамента и оператора для диалога;</li>
<li>создание и завершение диалога;</li>
<li>передача и прием текстовых сообщений;</li>
<li>прием файлов от оператора;</li>
<li>мгновенное оповещение о событиях: бан, оповещение о наборе, 
удерживающие сообщения, изменение оператора диалога,
закрытие диалога оператором;</li>
<li>просмотр истории сообщений;</li>
</ul>

<p>Документация API: </p>

<ul>
<li>
<a href="http://splusminusx.github.io/java/index.html">Android</a> </li>
<li><a href="http://splusminusx.github.io/ios/index.html">iOS</a></li>
</ul>

<p>Demo-приложение: </p>

<ul>
<li>
<a href="https://github.com/LiveTex/Livetex-Android-SDK-Demo">Android</a> </li>
<li><a href="https://github.com/LiveTex/Livetex-iOS-SDK-Demo">iOS</a></li>
</ul>

<h2>
<a id="С-чего-начать" class="anchor" href="#%D0%A1-%D1%87%D0%B5%D0%B3%D0%BE-%D0%BD%D0%B0%D1%87%D0%B0%D1%82%D1%8C" aria-hidden="true"><span class="octicon octicon-link"></span></a>С чего начать?</h2>

<h3>
<a id="Шаг-1-Создание-аккаунта" class="anchor" href="#%D0%A8%D0%B0%D0%B3-1-%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5-%D0%B0%D0%BA%D0%BA%D0%B0%D1%83%D0%BD%D1%82%D0%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>Шаг 1. Создание аккаунта</h3>

<p>Регистрируемся в системе <a href="https://billing.livetex.ru/signup/">Livetex</a>, 
добавляем <a href="https://billing.livetex.ru/operators/operator/add/">оператора</a> и 
<a href="https://billing.livetex.ru/site/add">сайт</a>.</p>

<h3>
<a id="Шаг-2-Получение-инструментов" class="anchor" href="#%D0%A8%D0%B0%D0%B3-2-%D0%9F%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B8%D0%BD%D1%81%D1%82%D1%80%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D0%BE%D0%B2" aria-hidden="true"><span class="octicon octicon-link"></span></a>Шаг 2. Получение инструментов</h3>

<p><a href="mailto:sdk@livetex.ru">Запрашиваем</a> ключ разработчика, доступ к 
"песочнице" и бинарный пакет SDK. В письме необходимо указать идентификатор
аккаунта и название платформы.</p>

<h3>
<a id="Шаг-3-Добавление-библиотеки-sdk-к-проекту" class="anchor" href="#%D0%A8%D0%B0%D0%B3-3-%D0%94%D0%BE%D0%B1%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B1%D0%B8%D0%B1%D0%BB%D0%B8%D0%BE%D1%82%D0%B5%D0%BA%D0%B8-sdk-%D0%BA-%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D1%83" aria-hidden="true"><span class="octicon octicon-link"></span></a>Шаг 3. Добавление библиотеки SDK к проекту</h3>

<p>Пример добавления библиотеки SDK к проекту можно найти в репозитории с 
demo-приложением.</p>

<h3>
<a id="Шаг-4-Разработка-обработчиков-оповещений-от-сервера" class="anchor" href="#%D0%A8%D0%B0%D0%B3-4-%D0%A0%D0%B0%D0%B7%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%BA%D0%B0-%D0%BE%D0%B1%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%87%D0%B8%D0%BA%D0%BE%D0%B2-%D0%BE%D0%BF%D0%BE%D0%B2%D0%B5%D1%89%D0%B5%D0%BD%D0%B8%D0%B9-%D0%BE%D1%82-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>Шаг 4. Разработка обработчиков оповещений от сервера</h3>

<p>Livetex SDK предоставляет возможность мгновенного оповещения о новых 
событиях от сервера. Новые события могут влиять на отображение информации 
пользователю приложения. Livetex SDK требует от разработчика реализации 
обработчика оповещений от сервера. Детали интерфейса обработчика можно найти 
по ссылкам:</p>

<ul>
<li>INotificationHandler <a href="http://splusminusx.github.io/java/nit/livetex/mymodule/sdk/handler/INotificationDialogHandler.html#INotificationDialogHandler">Android</a>
</li>
<li>LTMobileSDKNotificationHandlerProtocol <a href="http://splusminusx.github.io/ios/Protocols/LTMbileSDKNotificationHandlerProtocol/index.html#//apple_ref/occ/intf/LTMbileSDKNotificationHandlerProtocol">iOS</a>
</li>
</ul>

<p>Пример обработчика оповещений на Java с функциональностью открытия диалога и отсылки сообщения.</p>

<div class="highlight highlight-java"><pre>
<span class="pl-c">// Обработчик инициализации.</span>
<span class="pl-s">class</span> <span class="pl-en">CustomInitHandler</span> <span class="pl-s">implements</span> <span class="pl-e">IInitHandler</span> {

  <span class="pl-s">private</span> <span class="pl-stj">Livetex</span> sdk;

  <span class="pl-en">CustomInitHandler</span>(<span class="pl-stj">Livetex</span> <span class="pl-v">livetex</span>) {
    sdk <span class="pl-k">=</span> livetex;
  }

  <span class="pl-c">// В случае успешной инициализации сохраняем переданный токен и создаем обращение.</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">onSuccess</span>(<span class="pl-stj">String</span> <span class="pl-v">token</span>) {
    saveTokenToCustomClientStorage(token);
    sdk<span class="pl-k">.</span>request(<span class="pl-k">new</span> <span class="pl-st">AHandler&lt;<span class="pl-stj">State</span>&gt;</span>());
  }
}

<span class="pl-s">class</span> <span class="pl-en">CustomNotificationHandler</span> <span class="pl-s">implements</span> <span class="pl-e">INotificationHandler</span> {

  <span class="pl-s">private</span> <span class="pl-stj">Livetex</span> sdk;

  <span class="pl-en">CustomNotificationHandler</span>(<span class="pl-stj">Livetex</span> <span class="pl-v">livetex</span>) {
    sdk <span class="pl-k">=</span> livetex;
  }

  <span class="pl-c1">...</span>

  <span class="pl-c">// При назначении оператора для диалога отправляем приветственное сообщение.</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">updateDialogState</span>(<span class="pl-stj">DialogState</span> <span class="pl-v">state</span>) {
    <span class="pl-k">if</span> (state<span class="pl-k">.</span>isSetEmployee()) {
      sdk<span class="pl-k">.</span>sendTextMessage(<span class="pl-s1"><span class="pl-pds">"</span>Hello<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-st">AHandler&lt;<span class="pl-stj">TextMessage</span>&gt;</span>());
    }
  }

  <span class="pl-c">// Логируем сообщения оператора.</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">receiveTextMessage</span>(<span class="pl-stj">TextMessage</span> <span class="pl-v">message</span>) {
    <span class="pl-stj">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(message<span class="pl-k">.</span>getText());
  }
  <span class="pl-c1">...</span>
}
</pre></div>

<p>Пример обработчика оповещений на Objective-C с функциональностью открытия диалога и отсылки сообщения.</p>

<div class="highlight highlight-objective-c"><pre>
<span class="pl-st">@interface</span> <span class="pl-en">LTCustomNotificationDelegate</span> : <span class="pl-e">NSObject</span>  &lt;LTMobileSDKNotificationHandlerProtocol&gt;
<span class="pl-k">@property</span>(<span class="pl-k">nonatomic</span>, <span class="pl-k">copy</span>) <span class="pl-st">void</span> (^callBack) (<span class="pl-st">id</span> data);
<span class="pl-st">@end</span>

...

<span class="pl-st">@implementation</span> <span class="pl-en">LTCustomNotificationDelegate</span>

<span class="pl-c">// Обработка изменения состояния.</span>
- (<span class="pl-st">void</span>) <span class="pl-en">updateDialogState</span><span class="pl-en">:</span> (LTDialogState *) <span class="pl-vpf">state</span>
{
    <span class="pl-c">// Проверяем назначен ли оператор для диалога.</span>
    <span class="pl-k">if</span> (state.<span class="pl-vo">employee</span> != <span class="pl-c1">nil</span>) {
      <span class="pl-c">// Отправляем сообщение.</span>
      [sdk <span class="pl-s3">sendMessage:</span><span class="pl-s1"><span class="pl-pds">@"</span>Hello<span class="pl-pds">"</span></span> <span class="pl-s3">success:</span>^(LTTextMessage *message) {
        ...
      } <span class="pl-s3">failure:</span>^(<span class="pl-s3">NSException</span> *chatExeption) {
        ...
      }];
    }
}

<span class="pl-c">// Обработка нового сообщения от оператора.</span>
- (<span class="pl-st">void</span>) <span class="pl-en">receiveTextMessage</span><span class="pl-en">:</span> (LTTextMessage *) <span class="pl-vpf">message</span>
{
    <span class="pl-s3">NSLog</span>(message.<span class="pl-vo">text</span>);
}
<span class="pl-st">@end</span>
</pre></div>

<h3>
<a id="Шаг-5-Инициализация-sdk" class="anchor" href="#%D0%A8%D0%B0%D0%B3-5-%D0%98%D0%BD%D0%B8%D1%86%D0%B8%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F-sdk" aria-hidden="true"><span class="octicon octicon-link"></span></a>Шаг 5. Инициализация SDK</h3>

<p>Пример инициализации Android SDK в основном потоке приложения.</p>

<div class="highlight highlight-java"><pre><span class="pl-c">// URL сервиса аутентификации, получен на втором шаге данного гайда.</span>
string url <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>http://authentication-sandbox.livetex.ru:9000<span class="pl-pds">"</span></span>;

<span class="pl-c">// Ключ SDK для аутентификации кодовой базы клиент, получен на втором шаге данного гайда.</span>
string key <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>NEVER_SHOW_THIS_KEY_TO_STRANGERS<span class="pl-pds">"</span></span>;

<span class="pl-c">// Идентификатор приложения клиента - это идентификатор сайта, который можно </span>
<span class="pl-c">// получить в личном кабинете.</span>
string application <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>10001350<span class="pl-pds">"</span></span>;

<span class="pl-c">// Список возможностей реализованных в клиентском приложении.</span>
<span class="pl-st">List&lt;<span class="pl-stj">Capabilities</span>&gt;</span> capabilities <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-st">ArrayList&lt;<span class="pl-stj">Capabilities</span>&gt;</span>();

<span class="pl-c">// Клиентское приложение умеет вести диалог.</span>
capabilities<span class="pl-k">.</span>add(<span class="pl-stj">Capabilities</span><span class="pl-c1"><span class="pl-k">.</span>CHAT</span>);

<span class="pl-c">// Клиентское приложение умеет принимать файлы.</span>
capabilities<span class="pl-k">.</span>add(<span class="pl-stj">Capabilities</span><span class="pl-c1"><span class="pl-k">.</span>FILES_RECEIVE</span>);

<span class="pl-c">// Получение токена аутентификации из персистентного хранилища клиента SDK.</span>
<span class="pl-c">// Реализуется на усмотрение разработчика. На этапе инициализации SDK можно</span>
<span class="pl-c">// указать уникальный токен для идентификации клиента и восстановления </span>
<span class="pl-c">// истории переписки. Если токен указан не будет система создаст нового </span>
<span class="pl-c">// клиента.    </span>
<span class="pl-stj">String</span> token <span class="pl-k">=</span> getTokenFromCustomClientStorage();

<span class="pl-stj">Builder</span> builder <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">Builder</span>(context, key, application);
builder<span class="pl-k">.</span>addCapabilities(capabilities);
builder<span class="pl-k">.</span>addToken(token);
builder<span class="pl-k">.</span>addUrl(url);

<span class="pl-stj">Livetex</span> livetex <span class="pl-k">=</span> <span class="pl-k">new</span> builder.build();

<span class="pl-c">// Обработчик инициализации SDK реализуется разработчиком.</span>
<span class="pl-stj">CustomInitHandler</span> initHandler <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">CustomInitHandler</span>(livetex);
<span class="pl-c">// Обработчик оповещений от сервера реализуется разработчиком.</span>
<span class="pl-stj">CustomNotificationHandler</span> notificationHandler <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">CustomNotificationHandler</span>(livetex);

livetex<span class="pl-k">.</span>init(initHandler, notificationHandler);</pre></div>

<p>Пример инициализации iOS SDK в основном потоке приложения.</p>

<div class="highlight highlight-objective-c"><pre>LTMobileSDKInitializationParams *params = [LTMobileSDKInitializationParams <span class="pl-s3">new</span>];

<span class="pl-c">// URL сервиса аутентификации, получен на втором шаге данного гайда.</span>
params.livetexUrl = <span class="pl-s1"><span class="pl-pds">@"</span>http://authentication-sandbox.livetex.ru:9000<span class="pl-pds">"</span></span>;

<span class="pl-c">// Ключ SDK для аутентификации кодовой базы клиент, получен на втором шаге данного гайда.</span>
params.sdkKey = <span class="pl-s1"><span class="pl-pds">@"</span>NEVER_SHOW_THIS_KEY_TO_STRANGERS<span class="pl-pds">"</span></span>;


<span class="pl-c">// Идентификатор приложения клиента - это идентификатор сайта, который можно </span>
<span class="pl-c">// получить в личном кабинете.</span>
params.applicationId = <span class="pl-s1"><span class="pl-pds">@"</span>10001350<span class="pl-pds">"</span></span>;

LTMobileSDK *sdk = [[LTMobileSDK <span class="pl-s3">alloc</span>] <span class="pl-s3">initWithParams:</span>params];

<span class="pl-c">// Инициализация кастомного обработчика оповещений.</span>
LTCustomNotificationDelegate *delegate = [LTCustomNotificationDelegate <span class="pl-s3">new</span>];
sdk.delegate = delegate;

<span class="pl-c">// Инициализация SDK.</span>
[sdk <span class="pl-s3">runWithSuccess:</span>^(<span class="pl-s3">NSString</span> *token) {

    <span class="pl-c">// Запрос диалога с любым оператором.</span>
    [sdk <span class="pl-s3">requestWithSuccess:</span>^(LTDialogState *state) {
        <span class="pl-c">//...</span>
    } <span class="pl-s3">failure:</span>^(<span class="pl-s3">NSException</span> *chatExeption) {
        <span class="pl-c">//...</span>
    }];

} <span class="pl-s3">failure:</span>^(<span class="pl-s3">NSException</span> *exception) {
    <span class="pl-c">// ...</span>
}];</pre></div>

<p>Описанный выше пример позволяет реализовать следующий сценарий:</p>

<ol>
<li>Пользователь инициализирует SDK (вызов <code>init</code>).</li>
<li>При успешной инициализации SDK выполняется соответствующий обработчик (вызов <code>onSuccess</code>).</li>
<li>Тело обработчика успешной инициализации запрашивает диалог с оператором (вызов <code>request</code>).</li>
<li>Обработчик оповещений дожидается события назначения оператора для диалога (вызов <code>updateDialogState</code>).</li>
<li>Если оператор для диалога назначен отправляем сообщение (вызов <code>sendTextMessage</code>).</li>
<li>Сообщения принимаемые от оператора логируются (вызов <code>receiveTextMessage</code>). </li>
</ol>

<h2>
<a id="Замечания" class="anchor" href="#%D0%97%D0%B0%D0%BC%D0%B5%D1%87%D0%B0%D0%BD%D0%B8%D1%8F" aria-hidden="true"><span class="octicon octicon-link"></span></a>Замечания.</h2>

<p>LiveTex SDK предоставляет функциональность оценки чата и создания жалобы на диалог. Для полноценной работы данных опций необходимо, чтобы они были подключены в соответствующих разделах личного кабинета. </p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
